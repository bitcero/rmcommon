!function(e){this.CUImagesManager=function(s){this.uploadedIds=[],this.currentResizing=0,this.dropzone,this.okIcon='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14"><path d="M13.062 3.486c-.626-1.072-1.476-1.92-2.548-2.547S8.27 0 7 0C5.73 0 4.56.313 3.486.94 2.414 1.563 1.566 2.413.94 3.485.312 4.56 0 5.73 0 7s.313 2.44.94 3.514 1.474 1.922 2.546 2.547C4.56 13.69 5.73 14 7 14c1.27 0 2.44-.313 3.514-.94 1.072-.624 1.922-1.474 2.548-2.546S14 8.27 14 7c0-1.27-.312-2.44-.938-3.514zM11.54 5.934l-4.95 4.95c-.116.114-.255.173-.42.173-.157 0-.293-.06-.41-.174l-3.3-3.3c-.108-.11-.163-.246-.163-.41 0-.17.055-.31.164-.42l.83-.82c.12-.115.26-.173.41-.173.16 0 .3.058.41.173l2.06 2.06 3.72-3.71c.12-.115.26-.173.41-.173.16 0 .3.058.41.173l.83.82c.11.11.17.25.17.42 0 .165-.054.3-.163.41z"/></svg>',this.errorIcon='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14"><path d="M7 0C3.134 0 0 3.134 0 7c0 3.865 3.134 7 7 7 3.865 0 7-3.135 7-7 0-3.866-3.135-7-7-7zm0 11.36c-.482 0-.875-.39-.875-.874S6.518 9.61 7 9.61c.483 0 .875.392.875.876s-.392.875-.875.875zm.875-3.485c0 .482-.392.875-.875.875-.482 0-.875-.393-.875-.875V3.5c0-.482.393-.875.875-.875.483 0 .875.393.875.875v4.375z"/></svg>',this.init=function(i,r){var n=this;Dropzone.options.imagesUploader=!1,this.dropzone=new Dropzone(s,{url:i,acceptedFiles:".png, .jpg, .gif, .jpeg, .svg",maxFileSize:r,parallelUpload:1,autoProcessQueue:!0,params:{CUTOKEN_REQUEST:e("#cu-token").val()},dictDefaultMessage:cuLanguage.dzDefault,init:function(){this.on("success",function(e,s){n.serverResponse(e,s,n)}),this.on("queuecomplete",function(){e("#files-container").slideUp(),e("#images-resizing").slideDown(function(){n.resizeImages(n)})})}})},this.printMessage=function(s,i,r){var n=e("#uploading-messages > ul");e("#uploading-messages").is(":visible")||e("#uploading-messages").slideDown(200),"error"==s?n.append('<li class="error">'+r.errorIcon+" "+i):n.append('<li class="success">'+r.okIcon+" "+i)},this.updateProgress=function(s){var i=1/s.uploadedIds.length*100;i>0&&0==s.currentResizing?(e("#bar-indicator").css("width","100%"),e("#bar-indicator").html("100%")):(e("#bar-indicator").css("width",i*s.currentResizing+"%"),e("#bar-indicator").html(Math.round(i*s.currentResizing+1)+"%")),i*s.currentResizing>25&&e("#bar-indicator").removeClass("progress-bar-danger").addClass("progress-bar-warning"),i*s.currentResizing>65&&e("#bar-indicator").removeClass("progress-bar-warning").addClass("progress-bar-info"),this.currentResizing++},this.serverResponse=function(s,i,r){return void 0!=i.token&&""!=i.token&&e("#cu-token").val(i.token),void 0==i||"error"==i.type?(r.printMessage("error",s.name+": "+i.message,r),!1):(r.printMessage("success",i.message,r),r.uploadedIds.push(i.id),!0)},this.resizeImages=function(s){var i=s.uploadedIds;if(!(i.length<=0)){if(!0!==e("#images-resizing").is(":visible")&&e("#images-resizing").slideDown(function(){s.resizeImages(s)}),void 0==i[s.currentResizing])return e("#bar-indicator").html("100%"),e("#bar-indicator").animate({width:"100%"},200).removeClass("progress-bar-info").removeClass("active").addClass("progress-bar-success"),s.currentResizing=0,s.uploadedIds=[],e("button[data-action='upload-more']").fadeIn(300),e(s).trigger("resizeFinished"),void(e("#back-images").length>0&&e("#back-images").slideDown());s.sendResizeCommand(i[s.currentResizing],s)}},this.sendResizeCommand=function(s,i){var r={action:"resize",CUTOKEN_REQUEST:e("#cu-token").val(),img:s};e.get(xoUrl+"/modules/rmcommon/images.php",r,function(s){if("error"==s.type)return i.printMessage("error",s.message,i),i.updateProgress(i),void i.resizeImages(i);i.printMessage("success",s.message,i),i.updateProgress(i),e("#images-resizing span.message").html(cuLanguage.resizingLegend.replace("%1",i.currentResizing).replace("%2",i.uploadedIds.length)),i.resizeImages(i)},"json")},this.uploadMore=function(){var s=this;e("#images-resizing").slideUp(300,function(){e("#uploading-messages").slideUp(300,function(){e(this).find("ul > li").remove(),e("#files-container").slideDown(300),s.dropzone.removeAllFiles(),e("button[data-action='upload-more']").fadeOut(300)})})}}}(jQuery);