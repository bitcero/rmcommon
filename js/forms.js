var absurl="",users_field_name="",usersField=jQuery.extend({form_search_users:function(e,s,a,l){users_field_name=e,absurl=l;var d=$("#"+e+"-users-list input"),r="";for(i=0;i<d.length;i++)r+=""==r?$(d[i]).val():","+$(d[i]).val();var t=$("#"+e+"-users-container button").data("title");$("#"+e+"-dialog-search .modal-body").length<=0&&$("body").append('<div class="modal fade smartb-form-dialog users-form-selector" id="'+e+'-dialog-search"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">'+t+'</h4></div><div class="modal-body"></div></div></div></div>'),token=$("#cu-token").val();var n={type:a,limit:s,field:e,s:r,CUTOKEN_REQUEST:token};$.get(l+"/modules/rmcommon/ajax/users.php",n,function(i){if(0==cuHandler.retrieveAjax(i))return!1;$("#"+e+"-dialog-search .modal-body").html(i.content),$("#"+e+"-dialog-search").modal()},"json")},add_to_list:function(e){var i=$("#"+users_field_name+"-user-"+e),s=$("#"+users_field_name+"-username-"+e),a="#"+users_field_name+"-selected-list";if(i.is(":checked")){if($(a+" li.user_"+e).length>0)return;$(a).append("<li class='user_"+e+"'><label><input type='checkbox' value='"+e+"' checked='checked' onchange=\"usersField.remove_from_list("+e+")\" /> <span id='user-"+users_field_name+"-caption-"+e+"'>"+s.text()+"</span></label></li>"),$(a+" li.user_"+e).effect("highlight",{},"1000")}else{if($(a+" li.user_"+e).length<=0)return;$(a+" li.user_"+e).remove()}usersField.change_title(users_field_name)},remove_from_list:function(e){var i="#"+users_field_name+"-selected-list",s="#"+users_field_name+"-user-"+e;$(i+" li.user_"+e).length<=0||($(i+" li.user_"+e).remove(),usersField.change_title(users_field_name),$(s).length<=0||$(s).removeAttr("checked"))},change_title:function(){var e=$("#"+users_field_name+"-selected-title span"),i="#"+users_field_name+"-selected-list";e.text($(i+" li").length)},submit_search:function(e){var i=$("#"+users_field_name+"-limit").val();i=i<=0?30:i;var s=$("#"+users_field_name+"-kw").val();s=void 0==s?"":s;var a=$("#"+users_field_name+"-ord").val();sel=usersField.get_selected(users_field_name),usersField.show_waiting(1,users_field_name);var l={type:e,limit:i,field:users_field_name,kw:s,ord:a,s:sel,CUTOKEN_REQUEST:$("#cu-token").val()};usersField.show_waiting(0,users_field_name),$.get(xoUrl+"/modules/rmcommon/ajax/users.php",l,function(e){if(0==cuHandler.retrieveAjax(e))return!1;$("#"+users_field_name+"-dialog-search .modal-body").html(e.content)},"json")},show_waiting:function(e){e?$("#"+users_field_name+"-dialog-search .modal-body").html('<img src="'+absurl+'/modules/rmcommon/images/wait.gif" width="16" height="16" alt="" class="form_user_waiting_img" />'):$("#"+users_field_name+"-dialog-search .modal-body").html("")},get_selected:function(e){var s=$("#"+e+"-selected-list input"),a="";for(i=0;i<s.length;i++)a+=""==a?$(s[i]).val():","+$(s[i]).val();return a},goto_page:function(e,i){var s=usersField.get_selected(),a=$("#"+users_field_name+"-limit").val();a=a<=0?30:a;var l=$("#"+users_field_name+"-kw").val();l=void 0==l?"":l;var d=$("#"+users_field_name+"-ord").val(),r=e<=0?1:e;usersField.show_waiting(1);var t={type:i,limit:a,field:users_field_name,kw:l,ord:d,s:s,pag:r,XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val()};$.get(absurl+"/modules/rmcommon/ajax/users.php",t,function(e){usersField.show_waiting(0),$("#"+users_field_name+"-dialog-search .modal-body").html(e)})},insert_users:function(e,s){var a=e?"checkbox":"radio",l=e?users_field_name+"[]":users_field_name;if(e){var d=$("#"+users_field_name+"-selected-list input"),r="#"+users_field_name+"-exmuser-";for(i=0;i<d.length;i++)id=$(d[i]).val(),$(r+id).length>0||(li="<li id='"+users_field_name+"-exmuser-"+id+"'>",li+="<label>",li+="<a href='#' onclick='usersField.remove("+id+");'>&times;</a>",li+="<input type='"+a+"' value='"+id+"' name='"+l+"' id='"+users_field_name+"-"+id+"' checked='checked' />",li+=" "+$("#user-"+users_field_name+"-caption-"+id).text()+"</label></li>",$("#"+users_field_name+"-users-list").append(li))}else{var t="#"+users_field_name+"-user-"+s;$("#"+users_field_name+"-users-list li").remove(),$(t).length>0&&(li="<li id='"+users_field_name+"-exmuser-"+s+"'>",li+="<label>",li+="<a href='javascript:;' onclick='usersField.remove("+s+");'>&times;</a>",li+="<input type='"+a+"' value='"+s+"' name='"+l+"' id='"+users_field_name+"-"+s+"' checked='checked' />",li+=" "+$("#"+users_field_name+"-username-"+s).text()+"</label></li>",$("#"+users_field_name+"-users-list").append(li))}$("#"+users_field_name+"-dialog-search").modal("toggle")},remove:function(e){return $("#"+users_field_name+"-exmuser-"+e).remove(),!1}});$(document).ready(function(){$("form").validate(),$("body").on("change",".modules-field :checkbox",function(){var e=$(this).parents(".modules-field"),i=$(this).data("parent"),s=$(this).data("module"),a=$(this).data("all");if(void 0==i)if(void 0==s)void 0!=a&&($(e).find("[data-module]:checkbox").prop("checked",$(this).prop("checked")),$(e).find("[data-parent]:checkbox").prop("checked",$(this).prop("checked")));else{$(e).find("[data-parent='"+s+"']").prop("checked",$(this).prop("checked"));var l=$(e).find("[data-module]:checkbox").length,d=$(e).find("[data-module]:checked").length;if(d<l)$(e).find("[data-all]").prop("checked",!1);else{var r=$(e).find("[data-parent]:checkbox").length,t=$(e).find("[data-parent]:checked").length;t<r?$(e).find("[data-all]").prop("checked",!1):$(e).find("[data-all]").prop("checked",!0)}}else{(d=$(e).find("[data-parent='"+i+"']:checked").length)>0?$(e).find("[data-module='"+i+"']").prop("checked",!0):$(e).find("[data-module='"+i+"']").prop("checked",!1);r=$(e).find("[data-parent]:checkbox").length;(t=$(e).find("[data-parent]:checked").length)<r?$(e).find("[data-all]").prop("checked",!1):$(e).find("[data-all]").prop("checked",!0)}})});