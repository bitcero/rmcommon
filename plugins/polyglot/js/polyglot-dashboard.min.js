!function(a){var t=new PolyglotLang;this.Polyglot=function(){},this.Polyglot.prototype.notifyField=function(a){cuHandler.notify({type:"alert-warning",icon:"svg-rmcommon-warning",text:t.noFieldFilled.replace("%s","<strong>"+a+"</strong>")})},this.Polyglot.prototype.validateEditor=function(){var t=a("#langs-editor");if(t.length<=0)return!1;var e=!1,n={},o=this;return a(t).find("input[data-value]").each(function(){return void 0==a(this).val()||""==a(this).val()?(o.notifyField(a(t).find('label[data-field="'+a(this).data("value")+'"]').html()),e=!0,!1):void(n[a(this).data("value")]=a(this).val())}),a.isEmptyObject(n)||1==e?!1:(n.CUTOKEN_REQUEST=a("#cu-token").val(),n)},this.Polyglot.prototype.addLanguage=function(e){var n=a("#table-langs > tbody");return a(n).find('[data-lang="'+e.code+'"]').length>0&&cuHandler.notify({text:t.langExists.replace("%s","<strong>"+e.name+"</strong>"),type:"alert-warning",icon:"svg-rmcommon-warning"}),e.action="add-language",a("#langs-editor .create-lang").cuSpinner({icon:"svg-rmcommon-spinner-09"}),a.post("plugins.php?p=polyglot",e,function(t){if(!cuHandler.retrieveAjax(t))return a("#langs-editor input[data-value='name']").focus(),a("#langs-editor .create-lang").cuSpinner(),!1;a("#langs-editor input").val("");var e=a("<tr/>").data("lang",t.language.code);e.append("<td>&nbsp;</td>");var o=a("<td/>").append(t.language.name);e.append(o),o=a("<td/>").append(t.language.code).addClass("text-center"),e.append(o),o=a("<td/>").append('<img src="'+cuHandler.url("/modules/rmcommon/plugins/polyglot/flags/"+t.language.country+".png",!0)+'" alt="'+t.language.country+'">').addClass("text-center"),e.append(o),o=a("<td/>").append(t.language.file).addClass("text-center"),e.append(o),o=a("<td/>").append(t.language.directory).addClass("text-center"),e.append(o),o=a("<td/>").addClass("text-center cu-options");var l=a("<a/>").attr("href","#").data("option","edit").addClass("info");cuHandler.loadIcon("svg-rmcommon-pencil",l),o.append(l),$disable=a("<a/>").attr("href","#").data("option","disable").addClass("warning"),cuHandler.loadIcon("svg-rmcommon-pencil",$disable),o.append($disable),$delete=a("<a/>").attr("href","#").data("option","delete").addClass("danger"),cuHandler.loadIcon("svg-rmcommon-pencil",$delete),o.append($delete),e.append(o),a(n).append(e),a("#langs-editor .create-lang").cuSpinner()},"json"),!0},Polyglot.prototype.setBaseLanguage=function(t){var e={CUTOKEN_REQUEST:a("#cu-token").val(),action:"set-base",lang:t};a.post("plugins.php?p=polyglot",e,function(t){return cuHandler.retrieveAjax(t)?void a("#table-langs :radio").remove():!1},"json")},Polyglot.prototype.editLanguage=function(n){if(""==n)return null;var o=a("#table-langs tr[data-lang='"+n+"']");if(o.length<=0)return null;var l=o.find("td");l.each(function(o){if("base"!=a(this).data("field")){if("options"==a(this).data("field"))var l=a("<button/>").addClass("btn btn-warning").attr("data-lang-action","save-changes").html(t.saveChanges).click(function(){e.saveEdited(n)});else{var l=a("<input>").attr("type","text").addClass("form-control").attr("name",a(this).data("field"));"country"==a(this).data("field")?l.attr("value",a(this).data("value")):l.attr("value",a(this).html().trim())}a(this).html("").append(l)}}),o.find('input[name="name"]').focus().select()},Polyglot.prototype.saveEdited=function(t){if(void 0==t||""==t)return null;var e=a("#table-langs tr[data-lang='"+t+"']"),n={CUTOKEN_REQUEST:a("#cu-token").val(),old:t,code:e.find('input[name="code"]').val(),name:e.find('input[name="name"]').val(),country:e.find('input[name="country"]').val(),file:e.find('input[name="file"]').val(),directory:e.find('input[name="directory"]').val(),action:"save-changes"};a.post("plugins.php?p=polyglot",n,function(a){return cuHandler.retrieveAjax(a)?void window.location.reload(!0):(e.find('input[name="code"]').focus(),null)},"json")},Polyglot.prototype.deleteLanguage=function(e){if(void 0==e||""==e)return null;if(a("#table-langs tr[data-lang='"+e+"']").length<=0)return null;if(!confirm(t.confirmDelete))return null;var n={CUTOKEN_REQUEST:a("#cu-token").val(),code:e,action:"delete-language"};a.post("plugins.php?p=polyglot",n,function(a){return cuHandler.retrieveAjax(a)?void window.location.reload(!0):null},"json")},Polyglot.prototype.enableLanguage=function(e){if(void 0==e||""==e)return null;if(a("#table-langs tr[data-lang='"+e+"']").length<=0)return null;if(!confirm(t.confirmDisabling))return null;var n={CUTOKEN_REQUEST:a("#cu-token").val(),code:e,action:"enable-language"};a.post("plugins.php?p=polyglot",n,function(a){return cuHandler.retrieveAjax(a)?void window.location.reload(!0):null},"json")};var e=new Polyglot;a("#langs-editor .field-country").change(function(){if(""==a(this).val())return a(this).css("background-image",null),!1;var t=xoUrl+"/modules/rmcommon/plugins/polyglot/flags/"+a(this).val()+".png";a(this).css("background-image","url("+t+")")}),a("#langs-editor button.create-lang").click(function(){var a=e.validateEditor();return 0==a?!1:void e.addLanguage(a)}),a("body").on("click","#table-langs .type-changer",function(){return confirm(t.confirmBase)?void e.setBaseLanguage(a(this).val()):!1}),a("body").on("click",".cu-options a[data-option]",function(){switch(a(this).data("option")){case"edit":e.editLanguage(a(this).data("code"));break;case"enable":case"disable":e.enableLanguage(a(this).data("code"));break;case"delete":e.deleteLanguage(a(this).data("code"))}return!1})}(jQuery);
