var blocksAjax={messageTypes:{success:"success",error:"danger",warning:"warning",info:"info"},loadBlocker:function(){const e=document.createElement("div");return e.id="settings-blocker",document.body.appendChild(e),e},loadLoading:function(){const e=$.templates("#loading-tpl"),a=document.createElement("div");return a.id="settings-loading",a.innerHTML=e.render(),document.body.appendChild(a),a},unloadLoading:function(){$("#loading-blocker").fadeOut("fast",(function(){$(this).remove()}))},loadForm:function(e,a){var s={XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val(),module:a,block:e,action:"settings"};const o=this.loadBlocker();this.loadLoading(),$("#settings-blocker").fadeIn("fast",(function(){$("body").css("overflow","hidden"),$("#settings-loading").fadeIn("fast",(function(){$.post("ajax/blocks.php",s,(function(e){$("#settings-loading").fadeOut("fast",(function(){if(e.error)return blocksAjax.addMessage(e.message,blocksAjax.messageTypes.error),void blocksAjax.addToken(e.token);void 0!==e.message&&""!==e.message&&blocksAjax.addMessage(e.message,blocksAjax.messageTypes.info),blocksAjax.addToken(e.token);var a=document.createElement("div");a.id="settings-form-window",a.className="cu-box box-primary",a.innerHTML=e.data.content,o.appendChild(a),$(a).fadeIn("fast");document.querySelectorAll("#settings-form-window .settings-nav button").forEach((e=>{const a=new bootstrap.Tab(e);e.addEventListener("click",(e=>{e.preventDefault(),a.show()}))})),blocksAjax.eventChange()}))}),"json")}))}))},scrollId:function(e){var a=$("#"+e).position();$("html, body").animate({scrollTop:a.top},2e3)},eventChange:function(){$.ajax({url:"include/js/modules_field.js",dataType:"script",cache:!1})},close:function(){$("#settings-form-window").fadeOut("fast",(function(){$("#settings-blocker").fadeOut("fast",(function(){$(this).remove(),$("#settings-form-window").remove(),$("body").css("overflow","")}))}))},sendConfig:function(){var e=$("#frm-block-config").serialize();blocksAjax.close(),$("#settings-form-window").fadeOut("fast",(function(){$("#settings-loading").fadeIn("fast",(function(){$.post("ajax/blocks.php",e,(function(e){if($("#settings-loading").fadeOut("fast",(function(){$("#settings-blocker").fadeOut("fast")})),e.error)return blocksAjax.addMessage(e.message,blocksAjax.messageTypes.error),void blocksAjax.addToken(e.token);null!=e.message&&""!=e.message&&blocksAjax.addMessage(e.message,blocksAjax.messageTypes.info),blocksAjax.addToken(e.token);var a=$("#block-"+e.data.id);a.length<=0||($(a).data("position")!=e.data.canvas&&blocksAjax.addWithOrder(e.data,a),1==e.data.visible?($("#block-"+e.data.id+" a.control-visible").data("action","hide").attr("title",cuLanguage.hideBlock).removeClass("text-success").addClass("text-warning").children("i").removeClass("fa-eye").addClass("fa-eye-slash"),$("#block-"+e.data.id).removeClass("invisible-block")):($("#block-"+e.data.id+" a.control-visible").data("action","show").attr("title",cuLanguage.showBlock).removeClass("text-warning").addClass("text-success").children("i").removeClass("fa-eye-slash").addClass("fa-eye"),$("#block-"+e.data.id).addClass("invisible-block")),blocksAjax.saveOrder($("#position-"+e.data.canvas)))}),"json")}))}))},addWithOrder:function(e,a){var s=$("#position-"+e.canvas+" > ol > li");for($(a).data("position",e.canvas),s.length<=0&&$("#position-"+e.canvas+" > ol").append(a),i=0;i<s.length;i++)if(i>e.weight)return void $(s[i-1]).before(a);$("#position-"+e.canvas+" > ol").append(a)},saveOrder:function(e){var a=e.length?e:$(e.target),s={position:a.data("pos"),blocks:window.JSON.stringify(a.nestable("serialize")),action:"save-orders",XOOPS_TOKEN_REQUEST:$("#token-positions").val()};$.post("ajax/blocks.php",s,(function(e){blocksAjax.handleError(e)||""!=e.message&&($("#position-"+e.data.position+" > ol > li").attr("data-position",e.data.position),blocksAjax.addMessage(e.message,blocksAjax.messageTypes.info),blocksAjax.showOkIcon("#position-"+e.data.position))}),"json")},addBlockToPosition:function(e){if(null==e.id||e.id<=0)return blocksAjax.addMessage(cuLanguage.errorShowInPosition,blocksAjax.messageTypes.error),!1;var a='<li class="dd-item" data-id="'+e.id+'" id="block-'+e.id+'" data-position="'+e.position+'">';a+='<div class="item-controls d-flex justify-content-between align-items-center p-2">',a+='<strong class="dd-handle">'+e.title+"</strong>",a+='<div class="d-flex align-items-center"><a href="#" class="pull-right text-error" data-block="'+e.id+'" data-action="delete" title="'+cuLanguage.deleteBlock+'"><i class="fa fa-minus-circle text-danger"></i></a></div>',e.visible?a+='<a href="#" class="pull-right text-warning" data-block="'+e.id+'" data-action="hide" title="'+cuLanguage.hideBlock+'"><i class="fa fa-eye-slash"></i></a>':a+='<a href="#" class="pull-right text-success" data-block="'+e.id+'" data-action="show" title="'+cuLanguage.showBlock+'"><i class="fa fa-eye-slash"></i></a>',a+='<a href="#" class="pull-right" data-block="'+e.id+'" data-action="settings" title="'+cuLanguage.blockSettings+'"><i class="fa fa-wrench"></i></a>',a+="</div>",a+="</li>",$("#position-"+e.canvas.id_position).length<=0&&(e.canvas.id_position=blocksAjax.getFirstPosition().data("id")),$("#position-"+e.canvas.id_position+" ol.dd-list").length<=0&&$("#position-"+e.canvas.id_position).append('<ol class="dd-list"></ol>'),$("#position-"+e.canvas.id_position+" ol.dd-list").append(a)},getFirstPosition:function(){var e=$(".rmc-position-item");return $(e[0])},addMessage:function(e,a){const s=$.templates("#console-log-item"),o={message:e,type:a};$("#bk-messages").append(s.render(o)),$("#console-tab").effect("highlight",{},1e3)},addToken:function(e,a){1!=(a=null==a)||null!=e&&null!=e&&""!=e?$("#XOOPS_TOKEN_REQUEST").val(e):window.location.href="blocks.php"},changeVisibility:function(e,a){var s={XOOPS_TOKEN_REQUEST:$("#token-positions").val(),action:"show-block"==$("#block-"+e).data("action")?$("#block-"+e).data("action"):"hide-block",id:e};$.post("ajax/blocks.php",s,(function(a){if(blocksAjax.handleError(a))return!1;""!=a.message&&blocksAjax.addMessage(a.message,blocksAjax.messageTypes.info),blocksAjax.showOkIcon($("#block-"+e).data("position"));var s=a.data.visible;$("#block-"+e).data("action",1==s?"hide-block":"show-block"),$("#block-"+e+" .control-visible").attr("title",1==s?cuLanguage.hideBlock:cuLanguage.showBlock).removeClass(1==s?"text-success":"text-warning").addClass(1==s?"text-warning":"text-success").html('<i class="fa '+(1==s?"fa-eye-slash":"fa-eye")+'"></i>'),s?$("#block-"+e).removeClass("invisible-block"):$("#block-"+e).addClass("invisible-block")}),"json")},showOkIcon:function(e){if(null==e||""==e)return!1;$(e+"  h3 > svg").fadeIn("fast",(function(){setTimeout((function(){$(e+" h3 > svg").fadeOut("fast")}),1e3)}))},handleError:function(e,a){return a=null==a||a,1==e.error&&(blocksAjax.addMessage(e.message+"<br>"+e.data.error,blocksAjax.messageTypes.error),1==a&&blocksAjax.addToken(e.token),!0)},deleteBlock:function(e){if(confirm(cuLanguage.deleteBlockMessage)){var a={id:e,XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val(),action:"delete-block"};$.post("ajax/blocks.php",a,(function(a){if(blocksAjax.handleError(a,!0))return!1;blocksAjax.addMessage(a.message,blocksAjax.messageTypes.warning),blocksAjax.addToken(a.token,!0);var s=$("#block-"+e).data("position");return $("#block-"+e).remove(),blocksAjax.saveOrder($("#position-"+s)),!0}),"json")}}};function control_action(e,a){switch(e){case"settings":blocksAjax.loadForm(a);break;case"show":blocksAjax.changeVisibility(a,"show-block");break;case"hide":blocksAjax.changeVisibility(a,"hide-block");break;case"delete":blocksAjax.deleteBlock(a)}return!1}function before_submit(e){var a=$("tbody input"),s=!1;for(i=0;i<a.length;i++)$(a[i]).is(":checked")&&(s=!0);return s?("deletepos"==$("#bulk-topp").val()?confirm(cuLanguage.confirmPositionDeletion)&&($("#"+e).append('<input type="hidden" name="XOOPS_TOKEN_REQUEST" value="'+$("#XOOPS_TOKEN_REQUEST").val()+'">'),$("#"+e).submit()):$("#"+e).submit(),!1):(alert(cuLanguage.selectBefore),!1)}function select_option(e,a,s){p="frm-positions"==s?"p":"","edit"==a?($("#bulk-topp").val("edit"),$("#bulk-bottomp").val("edit"),$("#"+s+" input[type=checkbox]").removeAttr("checked"),$("#item-"+e).attr("checked","checked"),$("#"+s).submit()):"delete"==a&&($("#bulk-topp").val("deletepos"),$("#bulk-bottomp").val("deletepos"),$("#"+s+" input[type=checkbox]").removeAttr("checked"),$("#itemp-"+e).attr("checked","checked"),before_submit(s))}$(document).ready((function(){$("#add-pos-menu").click((function(){$("#exspos").click()})),$("#newpos").click((function(){return $("#bks-and-pos").is(":visible")?$("#bks-and-pos").fadeOut("fast",(function(){$("#blocks-list").fadeIn("fast"),$("#newpos").html(cuLanguage.showPositions).parent().removeClass("active")})):$("#blocks-list").fadeOut("fast",(function(){$("#bks-and-pos").fadeIn("fast"),$("#newpos").html(cuLanguage.showBlocks).parent().addClass("active")})),!1})),$("#blocks-available li a").click((function(){var e=(e=$(this).attr("id").replace("block-","")).split("-");mod=e[0],id=e[1];var a={XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val(),module:mod,block:id,action:"insert"};return $("#wait-buttons").fadeIn("slow"),$("#blocks-list").is(":visible")||$("#newpos").click(),$.post("ajax/blocks.php",a,(function(e){return e.error?(blocksAjax.addMessage(e.message,blocksAjax.messageTypes.error),blocksAjax.addToken(e.token),!1):(void 0!==e.message&&""!==e.message&&blocksAjax.addMessage(e.message,blocksAjax.messageTypes.info),blocksAjax.addToken(e.token),blocksAjax.addBlockToPosition(e.data.block),blocksAjax.loadForm(e.data.block.id),!1)}),"json"),!1}))}));