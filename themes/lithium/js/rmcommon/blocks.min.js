var blocksAjax={messageTypes:{success:"success",error:"danger",warning:"warning",info:"info"},loadBlocker:function(){const o=document.createElement("div");return o.id="settings-blocker",document.body.appendChild(o),o},loadLoading:function(){const o=$.templates("#loading-tpl"),t=document.createElement("div");return t.id="settings-loading",t.innerHTML=o.render(),document.body.appendChild(t),t},unloadLoading:function(){$("#loading-blocker").fadeOut("fast",(function(){$(this).remove()}))},loadForm:function(o,t){var e={XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val(),module:t,block:o,action:"settings"};const a=this.loadBlocker();this.loadLoading(),$("#settings-blocker").fadeIn("fast",(function(){$("body").css("overflow","hidden"),$("#settings-loading").fadeIn("fast",(function(){$.post("ajax/blocks.php",e,(function(o){$("#settings-loading").fadeOut("fast",(function(){if(o.error)return void blocksAjax.addToken(o.token);blocksAjax.addToken(o.token);var t=document.createElement("div");t.id="settings-form-window",t.className="cu-box box-primary",t.innerHTML=o.data.content,a.appendChild(t),$(t).fadeIn("fast");document.querySelectorAll("#settings-form-window .settings-nav button").forEach((o=>{const t=new bootstrap.Tab(o);o.addEventListener("click",(o=>{o.preventDefault(),t.show()}))})),blocksAjax.eventChange()}))}),"json")}))}))},scrollId:function(o){var t=$("#"+o).position();$("html, body").animate({scrollTop:t.top},2e3)},eventChange:function(){$.ajax({url:"include/js/modules_field.js",dataType:"script",cache:!1})},close:function(){$("#settings-form-window").fadeOut("fast",(function(){$("#settings-blocker").fadeOut("fast",(function(){$(this).remove(),$("#settings-form-window").remove(),$("body").css("overflow","")}))}))},sendConfig:function(){var o=$("#frm-block-config").serialize();blocksAjax.close(),$("#settings-form-window").fadeOut("fast",(function(){$("#settings-loading").fadeIn("fast",(function(){$.post("ajax/blocks.php",o,(function(o){if($("#settings-loading").fadeOut("fast",(function(){$("#settings-blocker").fadeOut("fast")})),o.error)blocksAjax.addToken(o.token);else{blocksAjax.addToken(o.token);var t=$("#block-"+o.data.id);t.length<=0||($(t).data("position")!=o.data.canvas&&blocksAjax.addWithOrder(o.data,t),1==o.data.visible?($("#block-"+o.data.id+" a.control-visible").data("action","hide").attr("title",cuLanguage.hideBlock).removeClass("text-success").addClass("text-warning").children("i").removeClass("fa-eye").addClass("fa-eye-slash"),$("#block-"+o.data.id).removeClass("invisible-block")):($("#block-"+o.data.id+" a.control-visible").data("action","show").attr("title",cuLanguage.showBlock).removeClass("text-warning").addClass("text-success").children("i").removeClass("fa-eye-slash").addClass("fa-eye"),$("#block-"+o.data.id).addClass("invisible-block")),blocksAjax.saveOrder($("#position-"+o.data.canvas)))}}),"json")}))}))},addWithOrder:function(o,t){var e=$("#position-"+o.canvas+" > ol > li");for($(t).data("position",o.canvas),e.length<=0&&$("#position-"+o.canvas+" > ol").append(t),i=0;i<e.length;i++)if(i>o.weight)return void $(e[i-1]).before(t);$("#position-"+o.canvas+" > ol").append(t)},saveOrder:function(o){var t=o.length?o:$(o.target),e={position:t.data("pos"),blocks:window.JSON.stringify(t.nestable("serialize")),action:"save-orders",XOOPS_TOKEN_REQUEST:$("#token-positions").val()};$.post("ajax/blocks.php",e,(function(o){blocksAjax.handleError(o)||""!=o.message&&($("#position-"+o.data.position+" > ol > li").attr("data-position",o.data.position),blocksAjax.showOkIcon("#position-"+o.data.position))}),"json")},addBlockToPosition:function(o){if(null==o.id||o.id<=0)return!1;var t='<li class="dd-item" data-id="'+o.id+'" id="block-'+o.id+'" data-position="'+o.position+'">';t+='<div class="item-controls d-flex justify-content-between align-items-center p-2">',t+='<strong class="dd-handle">'+o.title+"</strong>",t+='<div class="d-flex align-items-center"><a href="#" class="pull-right text-error" data-block="'+o.id+'" data-action="delete" title="'+cuLanguage.deleteBlock+'"><i class="fa fa-minus-circle text-danger"></i></a></div>',o.visible?t+='<a href="#" class="pull-right text-warning" data-block="'+o.id+'" data-action="hide" title="'+cuLanguage.hideBlock+'"><i class="fa fa-eye-slash"></i></a>':t+='<a href="#" class="pull-right text-success" data-block="'+o.id+'" data-action="show" title="'+cuLanguage.showBlock+'"><i class="fa fa-eye-slash"></i></a>',t+='<a href="#" class="pull-right" data-block="'+o.id+'" data-action="settings" title="'+cuLanguage.blockSettings+'"><i class="fa fa-wrench"></i></a>',t+="</div>",t+="</li>",$("#position-"+o.canvas.id_position).length<=0&&(o.canvas.id_position=blocksAjax.getFirstPosition().data("id")),$("#position-"+o.canvas.id_position+" ol.dd-list").length<=0&&$("#position-"+o.canvas.id_position).append('<ol class="dd-list"></ol>'),$("#position-"+o.canvas.id_position+" ol.dd-list").append(t)},getFirstPosition:function(){var o=$(".rmc-position-item");return $(o[0])},addMessage:function(o,t){const e=$.templates("#console-log-item"),a={message:o,type:t};$("#bk-messages").append(e.render(a)),$("#console-tab").effect("highlight",{},1e3)},addToken:function(o,t){1!=(t=null==t)||null!=o&&null!=o&&""!=o?$("#XOOPS_TOKEN_REQUEST").val(o):window.location.href="blocks.php"},changeVisibility:function(o,t){var e={XOOPS_TOKEN_REQUEST:$("#token-positions").val(),action:"show-block"==$("#block-"+o).data("action")?$("#block-"+o).data("action"):"hide-block",id:o};$.post("ajax/blocks.php",e,(function(t){if(blocksAjax.handleError(t))return!1;blocksAjax.showOkIcon($("#block-"+o).data("position"));var e=t.data.visible;$("#block-"+o).data("action",1==e?"hide-block":"show-block"),$("#block-"+o+" .control-visible").attr("title",1==e?cuLanguage.hideBlock:cuLanguage.showBlock).removeClass(1==e?"text-success":"text-warning").addClass(1==e?"text-warning":"text-success").html('<i class="fa '+(1==e?"fa-eye-slash":"fa-eye")+'"></i>'),e?$("#block-"+o).removeClass("invisible-block"):$("#block-"+o).addClass("invisible-block")}),"json")},showOkIcon:function(o){if(null==o||""==o)return!1;$(o+"  h3 > svg").fadeIn("fast",(function(){setTimeout((function(){$(o+" h3 > svg").fadeOut("fast")}),1e3)}))},handleError:function(o,t){return t=null==t||t,1==o.error&&(1==t&&blocksAjax.addToken(o.token),!0)},deleteBlock:function(o){if(confirm(cuLanguage.deleteBlockMessage)){var t={id:o,XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val(),action:"delete-block"};$.post("ajax/blocks.php",t,(function(t){if(blocksAjax.handleError(t,!0))return!1;blocksAjax.addToken(t.token,!0);var e=$("#block-"+o).data("position");return $("#block-"+o).remove(),blocksAjax.saveOrder($("#position-"+e)),!0}),"json")}}};function control_action(o,t){switch(o){case"settings":blocksAjax.loadForm(t);break;case"show":blocksAjax.changeVisibility(t,"show-block");break;case"hide":blocksAjax.changeVisibility(t,"hide-block");break;case"delete":blocksAjax.deleteBlock(t)}return!1}function before_submit(o){var t=$("tbody input"),e=!1;for(i=0;i<t.length;i++)$(t[i]).is(":checked")&&(e=!0);return e?("deletepos"==$("#bulk-topp").val()?confirm(cuLanguage.confirmPositionDeletion)&&($("#"+o).append('<input type="hidden" name="XOOPS_TOKEN_REQUEST" value="'+$("#XOOPS_TOKEN_REQUEST").val()+'">'),$("#"+o).submit()):$("#"+o).submit(),!1):(alert(cuLanguage.selectBefore),!1)}function select_option(o,t,e){p="frm-positions"==e?"p":"","edit"==t?($("#bulk-topp").val("edit"),$("#bulk-bottomp").val("edit"),$("#"+e+" input[type=checkbox]").removeAttr("checked"),$("#item-"+o).prop("checked","checked"),$("#"+e).submit()):"delete"==t&&($("#bulk-topp").val("deletepos"),$("#bulk-bottomp").val("deletepos"),$("#"+e+" input[type=checkbox]").removeAttr("checked"),$("#itemp-"+o).prop("checked",!0),before_submit(e))}$(document).ready((function(){$("#add-pos-menu").click((function(){$("#exspos").click()})),$("#newpos").click((function(){return $("#bks-and-pos").is(":visible")?$("#bks-and-pos").fadeOut("fast",(function(){$("#blocks-list").fadeIn("fast"),$("#newpos").html(cuLanguage.showPositions).parent().removeClass("active")})):$("#blocks-list").fadeOut("fast",(function(){$("#bks-and-pos").fadeIn("fast"),$("#newpos").html(cuLanguage.showBlocks).parent().addClass("active")})),!1})),$("#blocks-available li a").click((function(){var o=(o=$(this).attr("id").replace("block-","")).split("-");mod=o[0],id=o[1];var t={XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val(),module:mod,block:id,action:"insert"};return $("#wait-buttons").fadeIn("slow"),$("#blocks-list").is(":visible")||$("#newpos").click(),$.post("ajax/blocks.php",t,(function(o){return o.error?(blocksAjax.addToken(o.token),!1):(blocksAjax.addToken(o.token),blocksAjax.addBlockToPosition(o.data.block),blocksAjax.loadForm(o.data.block.id),!1)}),"json"),!1}))}));