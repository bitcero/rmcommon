var mdEditor={editors:{},buttons:{},callbacks:{},plugins:{},btn_tpl:'<button type="button" class="button" data-id="%id" data-editor="%e" accesskey="%k" title="%t">%c</button>',menu_item_tpl:'<button type="button" class="" data-id="%id" data-owner="%ow" data-editor="%e" accesskey="%k">%i %c</button>',btn_menu_tpl:'<div class="btn-group"><button type="button" class="button dropdown-toggle" data-toggle="dropdown" data-id="%id" data-editor="%e" accesskey="%k" title="%t">%c</button>%m</div>',menu_tpl:'<ul class="dropdown-menu" role="menu">%li</ul>',init:function(t,e){this.editors[t]=this.get(t,e),this.render_buttons(t),this.listeners()},get:function(t,e){return void 0==t||""==t?!1:CodeMirror.fromTextArea(document.getElementById(t),e)},add_button:function(t){return void 0==t.id||""==t.id?!1:void(void 0!=t.type&&"menu"==t.type?this.buttons[t.id]={caption:t.caption,id:t.id,callback:t.callback,icon:void 0!=t.icon?t.icon:"",key:t.key,content:t.content,"default":void 0!=t["default"]?t["default"]:"",type:void 0!=t.type?t.type:"button",menu:{}}:void 0!=t.owner&&""!=t.owner?this.buttons[t.owner].menu[t.id]={caption:t.caption,id:t.id,owner:t.owner,callback:t.callback,icon:void 0!=t.icon?t.icon:"",key:t.key,content:t.content,"default":void 0!=t["default"]?t["default"]:""}:this.buttons[t.id]={caption:t.caption,id:t.id,callback:t.callback,icon:void 0!=t.icon?t.icon:"",key:t.key,content:t.content,"default":void 0!=t["default"]?t["default"]:"",type:void 0!=t.type?t.type:"button"})},save:function(t){this.editors[t].save()},add_callback:function(t,e){this.callbacks[t]=e},render_buttons:function(t){$toolbar=$("#"+t+"-buttons-container > .toolbar-1");var e="<li>"+this.menu_tpl+"</li>";for(var n in this.buttons){var a=this.buttons[n];if(void 0!=this.buttons[n].menu)var o=this.btn_menu_tpl;else var o=this.btn_tpl;if(o=o.replace("%id",a.id),o=o.replace("%k",a.key),o=o.replace("%e",t),""!=a.icon?(o=o.replace("%t",a.caption),o=o.replace("%c",'<span class="'+a.icon+'"></span>')):o=o.replace("%c",a.caption),void 0!=this.buttons[n].menu){var i="";for(var c in this.buttons[n].menu){var d=a.menu[c],l="<li>"+this.menu_item_tpl+"</li>";l=l.replace("%id",d.id),l=l.replace("%ow",d.owner),l=l.replace("%k",d.key),l=l.replace("%e",t),l=""!=a.icon?l.replace("%i",'<span class="'+d.icon+'"></span>'):l.replace("%i",""),l=l.replace("%c",d.caption),i+=l}o=o.replace("%m",this.menu_tpl.replace("%li",i))}$toolbar.append(o)}},listeners:function(){var t=this;$(".ed-container > .ed-buttons > .toolbar-1  button").click(function(){var e=$(this).data("id"),n=$(this).data("owner");if(void 0!=e&&""!=e){if(void 0!=n&&""!=n){if(void 0==t.buttons[n])return;var a=t.buttons[n].menu[e]}else{if(void 0==t.buttons[e])return;var a=t.buttons[e]}var o=t.editors[$(this).data("editor")];if("function"==typeof a.callback)a.callback(o,t,e);else if("string"==typeof a.callback&&""!=a.callback){var i=a.callback;"function"==typeof t.callbacks[i]&&t.callbacks[i](o,t,e)}else"string"==typeof a.content&&t.insert($(this).data("editor"),a.content,a["default"])}})},insert:function(t,e,n){var a=this.editors[t],o=a.getSelection(),i=a.getCursor();""==o&&""!=n&&(o=n),""==o&&(i.ch+=e.split("%")[0].length),a.replaceSelection(e.replace("%",o)),""==o&&a.setCursor(i),a.focus()},selection:function(t){var e=this.editors[t],n={cursor:e.getCursor(),text:e.getSelection()};return n},popup_form:function(t,e){$("#"+t+"-ed-container .txtarea-container").append("<div id=")}};!function(t){t.add_button({id:"head",caption:"Heading",icon:"fa fa-header",key:"h",callback:"","default":"",content:"",type:"menu"}),t.add_button({id:"h1",owner:"head",caption:"<h1>Heading 1</h1>",icon:"",key:"1",callback:"","default":"",content:"# %"}),t.add_button({id:"h2",owner:"head",caption:"<h2>Heading 2</h2>",icon:"",key:"2",callback:"","default":"",content:"## %"}),t.add_button({id:"h3",owner:"head",caption:"<h3>Heading 3</h3>",icon:"",key:"3",callback:"","default":"",content:"### %"}),t.add_button({id:"h4",owner:"head",caption:"<h4>Heading 4</h4>",icon:"",key:"4",callback:"","default":"",content:"#### %"}),t.add_button({id:"h5",owner:"head",caption:"<h5>Heading 5</h5>",icon:"",key:"5",callback:"","default":"",content:"##### %"}),t.add_button({id:"h6",owner:"head",caption:"<h6>Heading 6</h6>",icon:"",key:"6",callback:"","default":"",content:"###### %"}),t.add_button({id:"bold",caption:"Bold",icon:"fa fa-bold",key:"b",callback:"",content:"**%**"}),t.add_button({id:"italic",caption:"Italic",icon:"fa fa-italic",key:"i",callback:"",content:"_%_"}),t.add_button({id:"strikethrough",caption:"Strikethrough",icon:"fa fa-strikethrough",key:"s",callback:"",content:"~~%~~"}),t.add_callback("list",function(t,e,n){var a=t.getSelection(),o=t.getCursor("from"),i="",c="list"==n?"*":"1";if(o.ch>0&&(i="\n\n"),a.length>0){var d=t.getLine(o.line);t.replaceSelection(d.length>o.ch+a.length?i+c+" "+a+"\n\n":i+c+" "+a+"\n\n"),o.line+=o.ch>0?2:0,o.ch=a.length+2,t.setCursor(o),t.focus()}else{c="*"==c?"* \n* \n* ":"1. \n2. \n3. ";var d=t.getLine(o.line);t.replaceSelection(d.length>o.ch?i+c+" \n\n":i+c),o.line+=o.ch>0?2:0,o.ch+=2,t.setCursor(o),t.focus()}}),t.add_button({id:"list",caption:"Unorderd list",icon:"fa fa-list-ul",key:"u",callback:"list",content:""}),t.add_button({id:"ordered",caption:"Unorderd list",icon:"fa fa-list-ol",key:"o",callback:"list",content:""}),t.add_button({id:"link",caption:"Insert Link",icon:"fa fa-chain",key:"l",callback:"","default":"Link Caption",content:"[%](insert url here)"}),t.add_button({id:"img",caption:"Insert Image",icon:"fa fa-image",key:"p",callback:"","default":"Alt Text",content:"![%](insert_image_url)"}),t.add_button({id:"quote",caption:"Insert Blockquote",icon:"fa fa-quote-left",key:"q",callback:"","default":"",content:"> %"}),t.add_button({id:"code",caption:"Inline code",icon:"fa fa-code",key:"c",callback:"","default":"code_goes_here",content:"`%`"}),t.add_button({id:"more",caption:"More elements",icon:"fa fa-toggle-down",key:"m",callback:"","default":"",content:"",type:"menu"}),t.add_button({id:"pre",owner:"more",caption:"Insert block code",icon:"fa fa-code",key:"",callback:"","default":"Code block goes here",content:"```\n%s\n```"}),t.add_button({id:"task",owner:"more",caption:"Insert task list",icon:"fa fa-check",key:"",callback:"","default":"Item list",content:"\n- [x] %\n- [x] Item list\n- [x] Item list\n\n"})}(mdEditor);
