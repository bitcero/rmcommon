var cuHandler={ismobile:/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),currentResponse:!1,loadRemoteDialog:function(launcher){var url=void 0!=$(launcher).attr("href")&&"#"!=$(launcher).attr("href")?$(launcher).attr("href"):$(launcher).data("url"),handler=$(launcher).data("handler"),window_id=$(launcher).data("window-id"),params_retriever=$(launcher).data("retriever"),params_setter=$(launcher).data("parameters");if(void 0!=params_retriever)var params=eval(params_retriever+"(launcher)");else if(void 0!=params_setter)eval("var params = "+params_setter);else var params={CUTOKEN_REQUEST:$("#cu-token").val()};return 0==params?!1:(cuHandler.showLoader(),$.get(url,params,function(response){return cuHandler.retrieveAjax(response)?(void 0==handler&&""!=handler?(cuHandler.closeLoader(),cuDialog.dialog({message:response.content,title:response.message,icon:void 0!=response.icon?response.icon:"",width:void 0!=response.width?response.width:"",id:void 0!=response.windowId?response.windowId:window_id,animate:!1,closeButton:void 0!=response.closeButton?response.closeButton:!0})):(cuHandler.closeLoader(),eval(handler+"(response, launcher);")),$(".cu-data-table").each(function(){cuHandler.createDataTable($(this))}),cuHandler.checkAjaxAction(response),!1):!1},"json"),!1)},submitAjaxForm:function(e){if(!$(e).valid())return!1;cuHandler.showLoader();var t=e.serialize();t+="&CUTOKEN_REQUEST="+$("#cu-token").val();var a=e.attr("action"),o=e.attr("method");return"post"==o?$.post(a,t,cuHandler.retrieveAjax,"json"):$.get(a,t,cuHandler.retrieveAjax,"json"),!1},retrieveAjax:function(e){return this.currentResponse=e,"error"==e.type&&(void 0!=e.modal_message?cuDialog.alert({message:e.message}):alert(e.message)),""!=e.token&&$("#cu-token").val(e.token),cuHandler.closeLoader(),cuHandler.checkAjaxAction(e),"error"==e.type?!1:!0},checkAjaxAction:function(data){return void 0!=data.showMessage&&alert(data.message),void 0!=data.closeWindow&&$(data.closeWindow).modal("hide"),void 0!=data.runHandler&&eval(data.runHandler+"(data)"),void 0!=data["goto"]&&(window.location.href=data["goto"]),void 0!=data["function"]&&eval(data["function"]),void 0!=data.openDialog&&cuDialog.dialog({message:data.content,title:data.message,icon:void 0!=data.icon?data.icon:"",width:void 0!=data.width?data.width:"",owner:void 0!=data.owner?data.owner:"",id:void 0!=data.windowId?data.windowId:"",animate:!1,closeButton:void 0!=data.closeButton?data.closeButton:!0}),void 0!=data.reload?void window.location.reload():void 0},showLoader:function(){$(".cu-window-loader").hide(),$(".cu-window-blocker").hide();var e='<div class="cu-window-blocker"></div>';e+='<div class="cu-window-loader"><div class="loader-container text-center"><button class="close" type="button">&times;</button><span>Operaci√≥n en progreso...</span></div></div>',$("body").append(e),$(".cu-window-blocker").fadeIn(0,function(){$(".cu-window-loader").fadeIn(1)})},closeLoader:function(e){$(".cu-window-loader").fadeOut(1,function(){$(".cu-window-blocker").fadeOut(0,function(){$(".cu-window-loader").remove(),$(".cu-window-blocker").remove()})})},getURI:function(module,controller,action,zone,params){var url=xoUrl;if(void 0!=cu_modules[module]&&void 0!=controller&&""!=controller)url+="backend"==zone?"/admin":"",url+=cu_modules[module]+"/"+controller+"/"+action+"/";else{if(url+="/modules/"+module,url+="backend"==zone?"/admin":"",""==controller||void 0==controller)return url;url+="/index.php/"+controller+"/"+action+"/"}if(void 0==params)return url;var query="";for(key in params)query+=(""==query?"?":"&")+key+"="+eval("params."+key);return url+query},createDataTable:function(e){if(!e.hasClass("dataTable")){var t=$(e).data("exclude");void 0!=t?t.toString().split(","):"";$(e).dataTable({bProcessing:!0,bServerSide:!0,sAjaxSource:$(e).data("source"),bPaginate:!0})}},runAction:function(e){var action=$(e).data("action");switch(action){case"load-remote-dialog":case"load-module-dialog":cuHandler.loadRemoteDialog(e);break;case"goto":var url=$(e).data("url");void 0==url&&(url=$(e).attr("href"));var retriever=$(e).data("retriever");void 0!=retriever&&(url+=eval(retriever+"(e)")),void 0!=url&&""!=url&&(window.location.href=url);break;default:eval(action+"(e)")}},enableCommands:function(id_activator,type){var commands=$("*[data-activator='"+id_activator+"']"),total=$("#"+id_activator+" :"+type+"[data-switch]:checked").length;$(commands).each(function(index){var required=void 0!=$(this).data("oncount")?$(this).data("oncount"):" >= 1";eval("total "+required)?$(this).enable():$(this).disable()})}};Number.prototype.formatMoney=function(e,t,a){var o=this,e=isNaN(e=Math.abs(e))?2:e,t=void 0==t?".":t,a=void 0==a?",":a,i=0>o?"-":"",n=parseInt(o=Math.abs(+o||0).toFixed(e))+"",r=(r=n.length)>3?r%3:0;return i+(r?n.substr(0,r)+a:"")+n.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+a)+(e?t+Math.abs(o-n).toFixed(e).slice(2):"")},jQuery.fn.enable=function(){this.each(function(){jQuery(this).removeAttr("disabled"),jQuery(this).removeClass("disabled")})},jQuery.fn.disable=function(){this.each(function(){jQuery(this).attr("disabled",!0),jQuery(this).addClass("disabled")})},$(document).ready(function(){var e="";if($("body").on("click","*[data-action]",function(){return $(this).is(":disabled")||$(this).attr("disabled")?!1:(cuHandler.runAction($(this)),!1)}),$("body").on("submit",'form[data-type="ajax"]',function(){return cuHandler.submitAjaxForm($(this)),!1}),$("body").on("click",".cu-window-loader .close",function(){cuHandler.closeLoader()}),$(".cu-data-table").each(function(){cuHandler.createDataTable($(this))}),$("*[data-rel='tooltip']").tooltip(),$("body").on("change",".activator-container :checkbox[data-switch], .activator-container :radio[data-switch]",function(){event.stopPropagation();var e=$(this).parents(".activator-container").attr("id");cuHandler.enableCommands(e,$(this).attr("type")),"radio"==$(this).attr("type")&&$(this).parents(".activator-container").find(".tr-checked").removeClass("tr-checked"),$(this).is(":checked")?$(this).parents("tr").addClass("tr-checked"):$(this).parents("tr").removeClass("tr-checked")}),$("body").on("change",":checkbox[data-checkbox]",function(){var e=$(this).data("checkbox");if(void 0!=e){$(":checkbox[data-oncheck='"+e+"']").prop("checked",$(this).prop("checked")).change();var t=$(this).parents(".activator-container");t.length>0&&cuHandler.enableCommands(t.attr("id"),"checkbox")}}),$("body").on("change",":checkbox",function(){if(!this.hasAttribute("data-checkbox")&&this.hasAttribute("data-oncheck")){var e=$(":checkbox[data-oncheck='"+$(this).data("oncheck")+"']"),t=$(":checkbox[data-oncheck='"+$(this).data("oncheck")+"']:checked"),a=$(":checkbox[data-checkbox='"+$(this).data("oncheck")+"']");t.length<e.length?$(a).removeAttr("checked"):t.length==e.length&&$(a).prop("checked","checked")}}),1==$("*[data-news='load']").length||$("*[data-boxes='load']").length>0){var t=$("*[data-news='load']");if(t.length<=0&&(t=$("*[data-boxes='load']")),t.length<=0)return!1;var a=t.data("module"),o=$(t.data("target"));void 0!=o&&o.html('<div class="text-success"><span class="fa fa-spinner fa-spin"></span> '+cuLanguage.downloadNews+"</div>");var n=$("*[data-boxes='load']"),r={module:a,CU_TOKEN:$("#cu-token").val()};$.get(xoUrl+"/modules/rmcommon/ajax/module-info.php",r,function(e){if("error"==e.type)return void o.html('<div class="text-danger"><span class="fa fa-exclamation-triangle"></span> '+cuLanguage.downloadNewsError+"</div>");if(void 0!=e.news&&void 0!=o){for(news=$("<ul>").addClass("cu-ajax-news list-unstyled"),i=0;i<e.news.length;i++){var t="<li><small>"+e.news[i].date+'</small><h5><a href="'+e.news[i].link+'" target="_blank">'+e.news[i].title+"</a></h5>";t+='<p class="help-block">'+e.news[i].content+"</p></li>",news.append(t)}o.html("").append(news),news.fadeIn("fast")}if(void 0!=e.boxes&&void 0!=n)for(i=0;i<e.boxes.length;i++){var a=$("<div>").addClass("cu-box").css("display","none");if(a.append('<div class="box-header"><span class="fa fa-caret-up box-handler"></span><h3>'+e.boxes[i].title+"</h3></div>"),a.append('<div class="box-content">'+e.boxes[i].content+"</div>"),void 0!=e.boxes[i].container){var r=$(e.boxes[i].container);r.length>0&&$(r).each(function(){var t=a.clone();"top"==e.boxes[i].position?$(this).prepend(t):$(this).append(t),t.fadeIn("fast")})}}},"json")}$("body").on("click",".ed-container .full-screen",function(){$(this).parents(".ed-container").addClass("full-screen-edit"),$(this).removeClass("full-screen").addClass("normal-screen"),e=$(this).parents(".ed-container").find(".txtarea-container").attr("style"),$(this).parents(".ed-container").find(".txtarea-container").attr("style",""),$("body").css("overflow","hidden")}),$("body").on("click",".ed-container .normal-screen",function(){$(this).parents(".ed-container").removeClass("full-screen-edit"),$(this).addClass("full-screen").removeClass("normal-screen"),$(this).parents(".ed-container").find(".txtarea-container").attr("style",e),e="",$("body").css("overflow","visible")}),$(".cu-notifications form .notification-item").change(function(){var e=$(this).data("event"),t=$(this).is(":checked")?1:0,a=$(this),o={event:e,status:t,page:"cu-notification-subscribe"};$.post(xoUrl+"/notifications.php",o,function(e){return"error"==e.type?void alert(e.message):void $(a).parent().parent().animate({backgroundColor:"#ffff99"},500,"linear",function(){$(this).animate({backgroundColor:"transparent"},500,"linear")})},"json")}),$(" #cu-notifications .cancel-subscription").click(function(){var e=$(this).data("info"),t=0,a=$(this),o={event:e,status:t,page:"cu-notification-subscribe"};$.post(xoUrl+"/notifications.php",o,function(e){return"error"==e.type?void alert(e.message):void $(a).parent().parent().slideUp(250,function(){$(this).remove()})},"json")})});
