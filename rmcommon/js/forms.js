var absurl="",users_field_name="",usersField=jQuery.extend({form_search_users:function(e,s,l,a){users_field_name=e,absurl=a;var r=$("#"+e+"-users-list input"),_="";for(i=0;i<r.length;i++)_+=""==_?$(r[i]).val():","+$(r[i]).val();token=$("#XOOPS_TOKEN_REQUEST").val();var n={type:l,limit:s,field:e,s:_,XOOPS_TOKEN_REQUEST:token};$.get(a+"/modules/rmcommon/ajax/users.php",n,function(s){$("#"+e+"-dialog-search .modal-body").html(s),$("#"+e+"-dialog-search").modal()},"html")},add_to_list:function(e){var s=$("#"+users_field_name+"-user-"+e),i=$("#"+users_field_name+"-username-"+e),l="#"+users_field_name+"-selected-list";if(s.is(":checked")){if($(l+" li.user_"+e).length>0)return;$(l).append("<li class='user_"+e+"'><label><input type='checkbox' value='"+e+"' checked='checked' onchange=\"usersField.remove_from_list("+e+")\" /> <span id='user-"+users_field_name+"-caption-"+e+"'>"+i.text()+"</span></label></li>"),$(l+" li.user_"+e).effect("highlight",{},"1000")}else{if($(l+" li.user_"+e).length<=0)return;$(l+" li.user_"+e).remove()}usersField.change_title(users_field_name)},remove_from_list:function(e){var s="#"+users_field_name+"-selected-list",i="#"+users_field_name+"-user-"+e;$(s+" li.user_"+e).length<=0||($(s+" li.user_"+e).remove(),usersField.change_title(users_field_name),$(i).length<=0||$(i).removeAttr("checked"))},change_title:function(){var e=$("#"+users_field_name+"-selected-title span"),s="#"+users_field_name+"-selected-list";e.text($(s+" li").length)},submit_search:function(e){var s=$("#"+users_field_name+"-limit").val();s=0>=s?30:s;var i=$("#"+users_field_name+"-kw").val();i=void 0==i?"":i;var l=$("#"+users_field_name+"-ord").val();sel=usersField.get_selected(users_field_name),usersField.show_waiting(1,users_field_name);var a={type:e,limit:s,field:users_field_name,kw:i,ord:l,s:sel,XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val()};usersField.show_waiting(0,users_field_name),$.get(baseurl+"/modules/rmcommon/ajax/users.php",a,function(e){$("#"+users_field_name+"-dialog-search .modal-body").html(e)},"html")},show_waiting:function(e){$("#"+users_field_name+"-dialog-search .modal-body").html(e?'<img src="'+absurl+'/modules/rmcommon/images/wait.gif" width="16" height="16" alt="" class="form_user_waiting_img" />':"")},get_selected:function(e){var s=$("#"+e+"-selected-list input"),l="";for(i=0;i<s.length;i++)l+=""==l?$(s[i]).val():","+$(s[i]).val();return l},goto_page:function(e,s){var i=usersField.get_selected(),l=$("#"+users_field_name+"-limit").val();l=0>=l?30:l;var a=$("#"+users_field_name+"-kw").val();a=void 0==a?"":a;var r=$("#"+users_field_name+"-ord").val(),_=0>=e?1:e;usersField.show_waiting(1);var n={type:s,limit:l,field:users_field_name,kw:a,ord:r,s:i,pag:_,XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val()};$.get(absurl+"/modules/rmcommon/ajax/users.php",n,function(e){usersField.show_waiting(0),$("#"+users_field_name+"-dialog-search .modal-body").html(e)})},insert_users:function(e,s){var l=e?"checkbox":"radio",a=e?users_field_name+"[]":users_field_name;if(e){var r=$("#"+users_field_name+"-selected-list input"),_="#"+users_field_name+"-exmuser-";for(i=0;i<r.length;i++)id=$(r[i]).val(),$(_+id).length>0||(li="<li id='"+users_field_name+"-exmuser-"+id+"'>",li+="<label>",li+="<a href='javascript:;' onclick='usersField.remove("+id+");'><span>remove</span></a>",li+="<input type='"+l+"' value='"+id+"' name='"+a+"' id='"+users_field_name+"-"+id+"' checked='checked' />",li+=" "+$("#user-"+users_field_name+"-caption-"+id).text()+"</label></li>",$("#"+users_field_name+"-users-list").append(li))}else{var n="#"+users_field_name+"-user-"+s;$("#"+users_field_name+"-users-list li").remove(),$(n).length>0&&(li="<li id='"+users_field_name+"-exmuser-"+s+"'>",li+="<label>",li+="<a href='javascript:;' onclick='usersField.remove("+s+");'><span>remove</span></a>",li+="<input type='"+l+"' value='"+s+"' name='"+a+"' id='"+users_field_name+"-"+s+"' checked='checked' />",li+=" "+$("#"+users_field_name+"-username-"+s).text()+"</label></li>",$("#"+users_field_name+"-users-list").append(li))}$("#"+users_field_name+"-dialog-search").modal("toggle")},remove:function(e){$("#"+users_field_name+"-exmuser-"+e).remove()}});$(document).ready(function(){$("form").validate()});
