var absurl="",users_field_name="",usersField=jQuery.extend({form_search_users:function(e,t,n,o){users_field_name=e,absurl=o;var s=$("#"+e+"-users-list input"),a="";for(i=0;i<s.length;i++)a+=""==a?$(s[i]).val():","+$(s[i]).val();$("#"+e+"-dialog-search .modal-body").length<=0&&$("body").append('<div class="modal fade smartb-form-dialog users-form-selector" id="'+e+'-dialog-search"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">%title</h4></div><div class="modal-body"></div></div></div></div>'),token=$("#cu-token").val();var r={type:n,limit:t,field:e,s:a,CUTOKEN_REQUEST:token};$.get(o+"/modules/rmcommon/ajax/users.php",r,function(t){if(0==cuHandler.retrieveAjax(t))return!1;$("#"+e+"-dialog-search .modal-body").html(t.content),$("#"+e+"-dialog-search").modal()},"json")},add_to_list:function(e){var t=$("#"+users_field_name+"-user-"+e),n=$("#"+users_field_name+"-username-"+e),i="#"+users_field_name+"-selected-list";if(t.is(":checked")){if($(i+" li.user_"+e).length>0)return;$(i).append("<li class='user_"+e+"'><label><input type='checkbox' value='"+e+"' checked='checked' onchange=\"usersField.remove_from_list("+e+")\" /> <span id='user-"+users_field_name+"-caption-"+e+"'>"+n.text()+"</span></label></li>"),$(i+" li.user_"+e).effect("highlight",{},"1000")}else{if($(i+" li.user_"+e).length<=0)return;$(i+" li.user_"+e).remove()}usersField.change_title(users_field_name)},remove_from_list:function(e){var t="#"+users_field_name+"-selected-list",n="#"+users_field_name+"-user-"+e;$(t+" li.user_"+e).length<=0||($(t+" li.user_"+e).remove(),usersField.change_title(users_field_name),$(n).length<=0||$(n).removeAttr("checked"))},change_title:function(){var e=$("#"+users_field_name+"-selected-title span"),t="#"+users_field_name+"-selected-list";e.text($(t+" li").length)},submit_search:function(e){var t=$("#"+users_field_name+"-limit").val();t=t<=0?30:t;var n=$("#"+users_field_name+"-kw").val();n=n==undefined?"":n;var i=$("#"+users_field_name+"-ord").val();sel=usersField.get_selected(users_field_name),usersField.show_waiting(1,users_field_name);var o={type:e,limit:t,field:users_field_name,kw:n,ord:i,s:sel,CUTOKEN_REQUEST:$("#cu-token").val()};usersField.show_waiting(0,users_field_name),$.get(xoUrl+"/modules/rmcommon/ajax/users.php",o,function(e){if(0==cuHandler.retrieveAjax(e))return!1;$("#"+users_field_name+"-dialog-search .modal-body").html(e.content)},"json")},show_waiting:function(e){e?$("#"+users_field_name+"-dialog-search .modal-body").html('<img src="'+absurl+'/modules/rmcommon/images/wait.gif" width="16" height="16" alt="" class="form_user_waiting_img" />'):$("#"+users_field_name+"-dialog-search .modal-body").html("")},get_selected:function(e){var t=$("#"+e+"-selected-list input"),n="";for(i=0;i<t.length;i++)n+=""==n?$(t[i]).val():","+$(t[i]).val();return n},goto_page:function(e,t){var n=usersField.get_selected(),i=$("#"+users_field_name+"-limit").val();i=i<=0?30:i;var o=$("#"+users_field_name+"-kw").val();o=o==undefined?"":o;var s=$("#"+users_field_name+"-ord").val(),a=e<=0?1:e;usersField.show_waiting(1);var r={type:t,limit:i,field:users_field_name,kw:o,ord:s,s:n,pag:a,XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val()};$.get(absurl+"/modules/rmcommon/ajax/users.php",r,function(e){usersField.show_waiting(0),$("#"+users_field_name+"-dialog-search .modal-body").html(e)})},insert_users:function(e,t){var n=e?"checkbox":"radio",o=e?users_field_name+"[]":users_field_name;if(e){var s=$("#"+users_field_name+"-selected-list input"),a="#"+users_field_name+"-exmuser-";for(i=0;i<s.length;i++)id=$(s[i]).val(),$(a+id).length>0||(li="<li id='"+users_field_name+"-exmuser-"+id+"'>",li+="<label>",li+="<a href='javascript:;' onclick='usersField.remove("+id+");'><span>remove</span></a>",li+="<input type='"+n+"' value='"+id+"' name='"+o+"' id='"+users_field_name+"-"+id+"' checked='checked' />",li+=" "+$("#user-"+users_field_name+"-caption-"+id).text()+"</label></li>",$("#"+users_field_name+"-users-list").append(li))}else{var r="#"+users_field_name+"-user-"+t;$("#"+users_field_name+"-users-list li").remove(),$(r).length>0&&(li="<li id='"+users_field_name+"-exmuser-"+t+"'>",li+="<label>",li+="<a href='javascript:;' onclick='usersField.remove("+t+");'><span>remove</span></a>",li+="<input type='"+n+"' value='"+t+"' name='"+o+"' id='"+users_field_name+"-"+t+"' checked='checked' />",li+=" "+$("#"+users_field_name+"-username-"+t).text()+"</label></li>",$("#"+users_field_name+"-users-list").append(li))}$("#"+users_field_name+"-dialog-search").modal("toggle")},remove:function(e){$("#"+users_field_name+"-exmuser-"+e).remove()}});$(document).ready(function(){$("form").validate()});