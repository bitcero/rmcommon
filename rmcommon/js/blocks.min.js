function control_action(e,t){switch(e){case"settings":blocksAjax.loadForm(t);break;case"show":blocksAjax.changeVisibility(t,"show-block");break;case"hide":blocksAjax.changeVisibility(t,"hide-block");break;case"delete":blocksAjax.deleteBlock(t)}return!1}function before_submit(e){var t=$("tbody input"),a=!1;for(i=0;i<t.length;i++)$(t[i]).is(":checked")&&(a=!0);return a?("deletepos"==$("#bulk-topp").val()?confirm(cuLanguage.confirmPositionDeletion)&&($("#"+e).append('<input type="hidden" name="XOOPS_TOKEN_REQUEST" value="'+$("#XOOPS_TOKEN_REQUEST").val()+'">'),$("#"+e).submit()):$("#"+e).submit(),!1):(alert(cuLanguage.selectBefore),!1)}function select_option(e,t,a){"frm-positions"==a?p="p":p="","edit"==t?($("#bulk-topp").val("edit"),$("#bulk-bottomp").val("edit"),$("#"+a+" input[type=checkbox]").removeAttr("checked"),$("#item-"+e).attr("checked","checked"),$("#"+a).submit()):"delete"==t&&($("#bulk-topp").val("deletepos"),$("#bulk-bottomp").val("deletepos"),$("#"+a+" input[type=checkbox]").removeAttr("checked"),$("#itemp-"+e).attr("checked","checked"),before_submit(a))}var blocksAjax={loadForm:function(e,t){var a={XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val(),module:t,block:e,action:"settings"};$("#settings-blocker").fadeIn("fast",function(){$("body").css("overflow","hidden"),$("#settings-loading").fadeIn("fast",function(){$.post("ajax/blocks.php",a,function(e){$("#settings-loading").fadeOut("fast",function(){return e.error?(blocksAjax.addMessage(e.message,"alert-error"),void blocksAjax.addToken(e.token)):(void 0!=e.message&&""!=e.message&&blocksAjax.addMessage(e.message,"alert-info"),blocksAjax.addToken(e.token),$("#settings-form-window").html(e.data.content).fadeIn("fast",function(){$("#block-config-form").css({top:$("#settings-form-window .title").height()+$("#settings-form-window .settings-nav").height()+20+"px",left:"20px",right:"20px",bottom:$("#settings-form-window .settings-form-controls").height()+30+"px"})}),void blocksAjax.eventChange())})},"json")})})},scrollId:function(e){var t=$("#"+e).position();$("html, body").animate({scrollTop:t.top},2e3)},eventChange:function(){$.ajax({url:"include/js/modules_field.js",dataType:"script",cache:!1})},close:function(){$("#settings-form-window").fadeOut("fast",function(){$("#settings-blocker").fadeOut("fast",function(){$("body").css("overflow","")})})},sendConfig:function(){var e=$("#frm-block-config").serialize();blocksAjax.close(),$("#settings-form-window").fadeOut("fast",function(){$("#settings-loading").fadeIn("fast",function(){$.post("ajax/blocks.php",e,function(e){if($("#settings-loading").fadeOut("fast",function(){$("#settings-blocker").fadeOut("fast")}),e.error)return blocksAjax.addMessage(e.message,"alert-danger"),void blocksAjax.addToken(e.token);void 0!=e.message&&""!=e.message&&blocksAjax.addMessage(e.message,"alert-info"),blocksAjax.addToken(e.token);var t=$("#block-"+e.data.id);t.length<=0||($(t).data("position")!=e.data.canvas&&blocksAjax.addWithOrder(e.data,t),1==e.data.visible?($("#block-"+e.data.id+" a.control-visible").data("action","hide").attr("title",cuLanguage.hideBlock).removeClass("text-success").addClass("text-warning").children("i").removeClass("fa-eye").addClass("fa-eye-slash"),$("#block-"+e.data.id).removeClass("invisible-block")):($("#block-"+e.data.id+" a.control-visible").data("action","show").attr("title",cuLanguage.showBlock).removeClass("text-warning").addClass("text-success").children("i").removeClass("fa-eye-slash").addClass("fa-eye"),$("#block-"+e.data.id).addClass("invisible-block")),blocksAjax.saveOrder($("#position-"+e.data.canvas)))},"json")})})},addWithOrder:function(e,t){var a=$("#position-"+e.canvas+" > ol > li");for($(t).data("position",e.canvas),a.length<=0&&$("#position-"+e.canvas+" > ol").append(t),i=0;i<a.length;i++)if(i>e.weight)return void $(a[i-1]).before(t);$("#position-"+e.canvas+" > ol").append(t)},saveOrder:function(e){var t=e.length?e:$(e.target),a={position:t.data("pos"),blocks:window.JSON.stringify(t.nestable("serialize")),action:"save-orders",XOOPS_TOKEN_REQUEST:$("#token-positions").val()};$.post("ajax/blocks.php",a,function(e){blocksAjax.handleError(e)||""!=e.message&&($("#position-"+e.data.position+" > ol > li").attr("data-position",e.data.position),blocksAjax.addMessage(e.message,"alert-info"),blocksAjax.showOkIcon("#position-"+e.data.position))},"json")},addBlockToPosition:function(e){if(void 0==e.id||e.id<=0)return blocksAjax.addMessage(cuLanguage.errorShowInPosition,"alert-error"),!1;var t='<li class="dd-item" data-id="'+e.id+'" id="block-'+e.id+'" data-position="'+e.position+'">';t+='<div class="row item-controls">',t+='<strong class="dd-handle">'+e.title+"</strong>",t+='<a href="#" class="pull-right text-error" data-block="'+e.id+'" data-action="delete" title="'+cuLanguage.deleteBlock+'"><i class="fa fa-minus-circle text-danger"></i></a>',t+=e.visible?'<a href="#" class="pull-right text-warning" data-block="'+e.id+'" data-action="hide" title="'+cuLanguage.hideBlock+'"><i class="fa fa-eye-slash"></i></a>':'<a href="#" class="pull-right text-success" data-block="'+e.id+'" data-action="show" title="'+cuLanguage.showBlock+'"><i class="fa fa-eye-slash"></i></a>',t+='<a href="#" class="pull-right" data-block="'+e.id+'" data-action="settings" title="'+cuLanguage.blockSettings+'"><i class="fa fa-wrench"></i></a>',t+="</div>",t+="</li>",$("#position-"+e.canvas.id_position).length<=0&&(e.canvas.id_position=blocksAjax.getFirstPosition().data("id")),$("#position-"+e.canvas.id_position+" ol.dd-list").length<=0&&$("#position-"+e.canvas.id_position).append('<ol class="dd-list"></ol>'),$("#position-"+e.canvas.id_position+" ol.dd-list").append(t)},getFirstPosition:function(){var e=$(".rmc-position-item");return $(e[0])},addMessage:function(e,t){var a='<div class="row-fluid">';a+='<div class="alert '+t+'">',a+='<button type="button" class="close" data-dismiss="alert">Ã—</button>',a+=e+"</div></div>",$("#bk-messages").prepend(a),$("#blocks-console-control").effect("highlight",{},1e3)},addToken:function(e,t){t=void 0==t?!0:!1,1!=t||null!=e&&void 0!=e&&""!=e?$("#XOOPS_TOKEN_REQUEST").val(e):window.location.href="blocks.php"},changeVisibility:function(e,t){var a={XOOPS_TOKEN_REQUEST:$("#token-positions").val(),action:"show-block"==$("#block-"+e).data("action")?$("#block-"+e).data("action"):"hide-block",id:e};$.post("ajax/blocks.php",a,function(t){if(blocksAjax.handleError(t))return!1;""!=t.message&&blocksAjax.addMessage(t.message,"alert-info"),blocksAjax.showOkIcon($("#block-"+e).data("position"));var a=t.data.visible;$("#block-"+e).data("action",1==a?"hide-block":"show-block"),$("#block-"+e+" .control-visible").attr("title",1==a?cuLanguage.hideBlock:cuLanguage.showBlock).removeClass(1==a?"text-success":"text-warning").addClass(1==a?"text-warning":"text-success").html('<i class="fa '+(1==a?"fa-eye-slash":"fa-eye")+'"></i>'),a?$("#block-"+e).removeClass("invisible-block"):$("#block-"+e).addClass("invisible-block")},"json")},showOkIcon:function(e){return void 0==e||""==e?!1:void $(e+"  h3 > .cu-icon").fadeIn("fast",function(){setTimeout(function(){$(e+" h3 > .cu-icon").fadeOut("fast")},1e3)})},handleError:function(e,t){return t=void 0==t?!0:t,1==e.error?(blocksAjax.addMessage(e.message+"<br>"+e.data.error,"alert-error"),1==t&&blocksAjax.addToken(e.token),!0):!1},deleteBlock:function(e){if(confirm(cuLanguage.deleteBlockMessage)){var t={id:e,XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val(),action:"delete-block"};$.post("ajax/blocks.php",t,function(t){if(blocksAjax.handleError(t,!0))return!1;blocksAjax.addMessage(t.message,"alert-warning"),blocksAjax.addToken(t.token,!0);var a=$("#block-"+e).data("position");return $("#block-"+e).remove(),blocksAjax.saveOrder($("#position-"+a)),!0},"json")}}};$(document).ready(function(){$("#add-pos-menu").click(function(){$("#exspos").click()}),jkmegamenu.definemenu("newban","megamenu1","click"),jkmegamenu.definemenu("blocks-console-control","blocks-console","click"),$("#newpos").click(function(){return $("#bks-and-pos").is(":visible")?$("#bks-and-pos").fadeOut("fast",function(){$("#blocks-list").fadeIn("fast"),$("#newpos").html(cuLanguage.showPositions).parent().removeClass("active")}):$("#blocks-list").fadeOut("fast",function(){$("#bks-and-pos").fadeIn("fast"),$("#newpos").html(cuLanguage.showBlocks).parent().addClass("active")}),!1}),$("#blocks-available li a").click(function(){var e=$(this).attr("id").replace("block-",""),e=e.split("-");mod=e[0],id=e[1];var t={XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val(),module:mod,block:id,action:"insert"};$("#wait-buttons").fadeIn("slow"),$("#blocks-list").is(":visible")||$("#newpos").click(),$.post("ajax/blocks.php",t,function(e){return e.error?(blocksAjax.addMessage(e.message,"alert-error"),blocksAjax.addToken(e.token),!1):(void 0!=e.message&&""!=e.message&&blocksAjax.addMessage(e.message,"alert-info"),blocksAjax.addToken(e.token),blocksAjax.addBlockToPosition(e.data.block),blocksAjax.loadForm(e.data.block.id),!1)},"json")}),$("a.edit_position").click(function(){var e=$(this).parent().parent().parent(),t=$("#"+$(e).attr("id")+" .pos_data");$("#editor-row").length>0&&($("#editor-row").hide(),$("#editor-row").remove(),$("tr").show());var a='<tr id="editor-row" style="display:none;" class="'+$(e).attr("class")+' editor" valign="top"><td>&nbsp;</td>';a+='<td><strong class="the_id">'+$(e).attr("id").replace("ptr-","")+"</strong></td>",a+='<td><input type="text" name="name" id="ed-name" class="form-control" value="'+$(t).children(".name").html()+'"><br />',a+='<button type="submit" class="save_button btn btn-primary">'+cuLanguage.save+"</button>",a+='<button type="button" class="cancel_button btn btn-default">'+cuLanguage.cancel+"</button>",a+="</td>",a+='<td align="center"><input type="text" name="tag" id="ed-tag" class="form-control" value="'+$(t).children(".ptag").html()+'"></td>',a+='<td align="center"><input type="checkbox" name="active" id="ed-active" value="1" '+("1"==$(t).children(".active").html()?' checked="checked"':"")+'" /></td>',a+="</tr>",$(e).after(a),$(e).hide(),$("#editor-row").show(),$("#editor-row .cancel_button").click(function(){$("#editor-row").hide(),$("#editor-row").remove(),$("tr").show()}),$("#editor-row .save_button").click(function(){var t={action:"savepos",id:$("#editor-row .the_id").html(),name:$("#editor-row #ed-name").val(),tag:$("#editor-row #ed-tag").val(),active:$("#editor-row #ed-active").is(":checked")?"1":0,XOOPS_TOKEN_REQUEST:$("#XOOPS_TOKEN_REQUEST").val()};return $.post("ajax/blocks.php",t,function(t){return blocksAjax.handleError(t.message,!0)?void 0:(blocksAjax.addMessage(t.message,"alert-info"),blocksAjax.addToken(t.token,!0),e="#ptr-"+$("#editor-row .the_id").html(),$(e+" .name").html($("#editor-row #ed-name").val()),$(e+" .ptag").html($("#editor-row #ed-tag").val()),$("#editor-row #ed-active").is(":checked")?($(e+" img.active").attr("src","images/done.png"),$(e+" .pos_data .active").html(1)):($(e+" img.active").attr("src","images/closeb.png"),$(e+" .pos_data .active").html(0)),$("#editor-row").hide(),$("#editor-row").remove(),e=e.replace("#ptr-",""),$("#ptr-"+e).show(),$("#ptr-"+e).effect("highlight",{},1e3),!1)},"json"),!1})})});
