function show_image_pop(e){var s=new Image;
// wrap our new image in jQuery, then:
$(s).load(function(){
// set the image hidden by default    
$(this).hide("slow",function(){$(this).fadeIn("slow",function(){$("#image-loader").html(this).animate({width:$(this).width()+"px",height:$(s).height()+"px",marginLeft:"-"+$(s).width()/2+"px",marginTop:"-"+$(s).height()/2+"px"})})})}).error(function(){}).attr("src",e).attr("onclick",'$("#image-loader").hide("slow");')}var cuImagesManager;!function(e){this.CUImagesManager=function(){
// All uploaded images
this.uploadedIds=[],
// Current resized image
this.currentResizing=0,
// Dropzone
this.dropzone,
// Icons
this.okIcon='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14"><path d="M13.062 3.486c-.626-1.072-1.476-1.92-2.548-2.547S8.27 0 7 0C5.73 0 4.56.313 3.486.94 2.414 1.563 1.566 2.413.94 3.485.312 4.56 0 5.73 0 7s.313 2.44.94 3.514 1.474 1.922 2.546 2.547C4.56 13.69 5.73 14 7 14c1.27 0 2.44-.313 3.514-.94 1.072-.624 1.922-1.474 2.548-2.546S14 8.27 14 7c0-1.27-.312-2.44-.938-3.514zM11.54 5.934l-4.95 4.95c-.116.114-.255.173-.42.173-.157 0-.293-.06-.41-.174l-3.3-3.3c-.108-.11-.163-.246-.163-.41 0-.17.055-.31.164-.42l.83-.82c.12-.115.26-.173.41-.173.16 0 .3.058.41.173l2.06 2.06 3.72-3.71c.12-.115.26-.173.41-.173.16 0 .3.058.41.173l.83.82c.11.11.17.25.17.42 0 .165-.054.3-.163.41z"/></svg>',this.errorIcon='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14"><path d="M7 0C3.134 0 0 3.134 0 7c0 3.865 3.134 7 7 7 3.865 0 7-3.135 7-7 0-3.866-3.135-7-7-7zm0 11.36c-.482 0-.875-.39-.875-.874S6.518 9.61 7 9.61c.483 0 .875.392.875.876s-.392.875-.875.875zm.875-3.485c0 .482-.392.875-.875.875-.482 0-.875-.393-.875-.875V3.5c0-.482.393-.875.875-.875.483 0 .875.393.875.875v4.375z"/></svg>',this.init=function(s,r){var a=this;Dropzone.options.imagesUploader=!1,this.dropzone=new Dropzone("form#images-uploader",{url:s,acceptedFiles:".png, .jpg, .gif, .jpeg, .svg",maxFileSize:r,parallelUpload:1,autoProcessQueue:!0,params:{CUTOKEN_REQUEST:e("#cu-token").val()},
// JS strings for rmcommon must be included
dictDefaultMessage:cuLanguage.dzDefault,
// Events listerners
init:function(){this.on("success",function(e,s){a.serverResponse(e,s,a)}),this.on("queuecomplete",function(){e("#files-container").slideUp(300),e("#images-resizing").slideDown(300,function(){a.resizeImages(a)})})}})},/**
         * Print a message in "Uploading messages" log
         * @param type
         * @param message
         * @param $this
         */
this.printMessage=function(s,r,a){var i=e("#uploading-messages > ul");e("#uploading-messages").is(":visible")||e("#uploading-messages").slideDown(200),"error"==s?i.append('<li class="error">'+a.errorIcon+" "+r):i.append('<li class="success">'+a.okIcon+" "+r)},/**
         * Update the progress bar
         * @param $this
         */
this.updateProgress=function(s){var r=s.uploadedIds.length,a=1/r*100;e("#bar-indicator").animate({width:a*s.currentResizing+"%"},200),
//$("#bar-indicator").css('width', percent*(current+1)+'%');
e("#bar-indicator").html(Math.round(a*s.currentResizing+1)+"%"),a*s.currentResizing>25&&e("#bar-indicator").removeClass("progress-bar-danger").addClass("progress-bar-warning"),a*s.currentResizing>65&&e("#bar-indicator").removeClass("progress-bar-warning").addClass("progress-bar-info"),this.currentResizing++},/**
         * Process the server response
         * @param file
         * @param response
         * @param $this
         * @returns {boolean}
         */
this.serverResponse=function(s,r,a){return r=JSON.parse(r),void 0!=r.token&&""!=r.token&&e("#cu-token").val(r.token),void 0==r||"error"==r.type?(a.printMessage("error",s.name+": "+r.message,a),!1):(a.printMessage("success",r.message,a),a.uploadedIds.push(r.id),!0)},/**
         * Resize a image element
         * @param $this
         */
this.resizeImages=function(s){var r=s.uploadedIds;if(!(r.length<=0))return void 0==r[s.currentResizing]?(e("#bar-indicator").html("100%"),e("#bar-indicator").animate({width:"100%"},200).removeClass("progress-bar-info").removeClass("active").addClass("progress-bar-success"),s.currentResizing=0,s.uploadedIds=[],void e("button[data-action='upload-more']").fadeIn(300)):void s.sendResizeCommand(r[s.currentResizing],s)},/**
         * Send the instruction to resize a specific image
         * @param id
         * @param $this
         */
this.sendResizeCommand=function(s,r){var a={action:"resize",CUTOKEN_REQUEST:e("#cu-token").val(),img:s};e.get(xoUrl+"/modules/rmcommon/images.php",a,function(s){return"error"==s.type?(r.printMessage("error",s.message,r),r.updateProgress(r),void r.resizeImages(r)):(r.printMessage("success",s.message,r),r.updateProgress(r),e("#images-resizing span.message").html(cuLanguage.resizingLegend.replace("%1",r.currentResizing).replace("%2",r.uploadedIds.length)),void r.resizeImages(r))},"json")},this.uploadMore=function(){var s=this;e("#images-resizing").slideUp(300,function(){e("#uploading-messages").slideUp(300,function(){e(this).find("ul > li").remove(),e("#files-container").slideDown(300),s.dropzone.removeAllFiles(),e("button[data-action='upload-more']").fadeOut(300)})})}},cuImagesManager=new CUImagesManager,e(document).ready(function(){e("button[data-action='upload-more']").click(function(){cuImagesManager.uploadMore()})})}(jQuery);
